schema: '2.0'
stages:
  prepare_data:
    cmd: python src-preparation/1_retrieve_dataset.py
    deps:
    - path: data/openfoodfacts-products.jsonl.gz
      hash: md5
      md5: b265ce845922d5c969381e0c9a09459c
      size: 9877182037
    - path: src-preparation/1_retrieve_dataset.py
      hash: md5
      md5: ef5f74af6198070a2e0935376f70327d
      size: 6420
    outs:
    - path: gen/off_selected_fields_filtered.csv
      hash: md5
      md5: 01cc324969a6352dbaed554bb7f8cc0f
      size: 1363560418
    - path: gen/openfoodfacts_10records.txt
      hash: md5
      md5: 0e2845e430750f1893590383a74a17fe
      size: 227002
  retrieve:
    cmd: python src-preparation/1_retrieve_dataset.py
    deps:
    - path: data/openfoodfacts-products.jsonl.gz
      hash: md5
      md5: b265ce845922d5c969381e0c9a09459c
      size: 9877182037
    - path: src-preparation/1_retrieve_dataset.py
      hash: md5
      md5: ef5f74af6198070a2e0935376f70327d
      size: 6420
    outs:
    - path: gen/off_selected_fields_filtered.csv
      hash: md5
      md5: 01cc324969a6352dbaed554bb7f8cc0f
      size: 1363560418
    - path: gen/openfoodfacts_10records.txt
      hash: md5
      md5: 0e2845e430750f1893590383a74a17fe
      size: 227002
  prepare:
    cmd: Rscript src-preparation/2_prepare_data.R
    deps:
    - path: gen/off_selected_fields_filtered.csv
      hash: md5
      md5: 01cc324969a6352dbaed554bb7f8cc0f
      size: 1363560418
    - path: src-preparation/2_prepare_data.R
      hash: md5
      md5: d3ea8c77084a73fa42d23d0e357e94cd
      size: 3191
    outs:
    - path: gen/categories_long.csv
      hash: md5
      md5: 6bd2ef7d52115b167f7edb3282fb93fa
      size: 77892925
    - path: gen/categories_wide.csv
      hash: md5
      md5: 06318a920b79e6a3241fb8b742f930d1
      size: 66297866
    - path: gen/label_freq.csv
      hash: md5
      md5: 721762af7aa34f077ed8fc97927863de
      size: 393331
    - path: gen/labels_long.csv
      hash: md5
      md5: 3150ddd797cf27ec644456304a160e8b
      size: 31244498
    - path: gen/main_data.csv
      hash: md5
      md5: f16b9630ba58a5ac80f6595863d315b1
      size: 121448048
  category_mapping:
    cmd: Rscript src-preparation/3_category_mapping.R
    deps:
    - path: gen/categories_long.csv
      hash: md5
      md5: 6bd2ef7d52115b167f7edb3282fb93fa
      size: 77892925
    - path: gen/categories_wide.csv
      hash: md5
      md5: 06318a920b79e6a3241fb8b742f930d1
      size: 66297866
    - path: gen/main_data.csv
      hash: md5
      md5: f16b9630ba58a5ac80f6595863d315b1
      size: 121448048
    - path: src-preparation/3_category_mapping.R
      hash: md5
      md5: 05edc0d18dc8f69a3de4f318902d934e
      size: 12066
    outs:
    - path: gen/cat_harmonized_freq.csv
      hash: md5
      md5: e6c6ee43227faa2e9adb798c8d555862
      size: 1576
    - path: gen/category_mapped_data.csv
      hash: md5
      md5: e90c8d6b04eec8cb6a8cb42467e153d8
      size: 42760521
    - path: gen/category_mapped_filtered.csv
      hash: md5
      md5: 10caa8930e86e4dc312e9a6520d9d4d9
      size: 39186278
    - path: gen/rule_hits.csv
      hash: md5
      md5: 8964d1584275054264caba68fe2253a8
      size: 35460688
  label_mapping:
    cmd: Rscript src-preparation/4_label_mapping.R
    deps:
    - path: data/labels_mapping.xlsx
      hash: md5
      md5: ce339f1f5c5b6cdcf11a168601cb7b27
      size: 485567
    - path: gen/category_mapped_filtered.csv
      hash: md5
      md5: 10caa8930e86e4dc312e9a6520d9d4d9
      size: 39186278
    - path: gen/labels_long.csv
      hash: md5
      md5: 3150ddd797cf27ec644456304a160e8b
      size: 31244498
    - path: src-preparation/4_label_mapping.R
      hash: md5
      md5: 08d2f1de41a9e287f17c5495f7d2f182
      size: 3294
    outs:
    - path: gen/label_mapped_filtered.csv
      hash: md5
      md5: a8a3710dde001257c1087be19a9b91d1
      size: 46269243
    - path: gen/labels_def.csv
      hash: md5
      md5: e37b8694b6f348072645963d9173daba
      size: 100190797
    - path: gen/labels_string_df.csv
      hash: md5
      md5: b6f7fa31d117f5b80669181e28156af3
      size: 34758863
  final_dataset:
    cmd: Rscript src-preparation/5_create_final_dataset.R
    deps:
    - path: gen/label_mapped_filtered.csv
      hash: md5
      md5: a8a3710dde001257c1087be19a9b91d1
      size: 46269243
    - path: gen/off_selected_fields_filtered.csv
      hash: md5
      md5: 01cc324969a6352dbaed554bb7f8cc0f
      size: 1363560418
    - path: src-preparation/5_create_final_dataset.R
      hash: md5
      md5: e8bea312cff3e028c60b5375b9d564e2
      size: 3803
    outs:
    - path: gen/data_def_cat1.csv
      hash: md5
      md5: 5333354116017e104e9576d47d3038bb
      size: 17104759
    - path: gen/data_def_cat12.csv
      hash: md5
      md5: 8ba1c75b73002583afd62c0699406518
      size: 50374419
    - path: gen/data_def_cat123.csv
      hash: md5
      md5: afb9d8a1ee4f7e74bb293f0553af227b
      size: 54659768
    - path: gen/data_def_cat23.csv
      hash: md5
      md5: 43f5f93dc54dd4ac05faf3c229b6b011
      size: 46398858
    - path: gen/data_def_cat3.csv
      hash: md5
      md5: e72749cb0a11ce76e4a27467e87801d7
      size: 13647062
    - path: results/data_def.csv
      hash: md5
      md5: afb9d8a1ee4f7e74bb293f0553af227b
      size: 54659768
  explore:
    cmd: Rscript src-preparation/6_explore_final_dataset.R
    deps:
    - path: gen/label_freq.csv
      hash: md5
      md5: 721762af7aa34f077ed8fc97927863de
      size: 393331
    - path: gen/labels_long.csv
      hash: md5
      md5: 3150ddd797cf27ec644456304a160e8b
      size: 31244498
    - path: results/data_def.csv
      hash: md5
      md5: afb9d8a1ee4f7e74bb293f0553af227b
      size: 54659768
    - path: src-preparation/6_explore_final_dataset.R
      hash: md5
      md5: eb83b448dccabdd7f47347169d7f6bf8
      size: 9436
    outs:
    - path: plots/
      hash: md5
      md5: 896ea3a78620cef16905a8eb0284e924.dir
      size: 1273879
      nfiles: 4
  split_data:
    cmd: python src-modeling/1.0_split_dataset.py
    deps:
    - path: results/data_def.csv
      hash: md5
      md5: afb9d8a1ee4f7e74bb293f0553af227b
      size: 54659768
    - path: src-modeling/1.0_split_dataset.py
      hash: md5
      md5: 73f4b0514fe860a3ffd7a9759dcc0298
      size: 5036
    outs:
    - path: gen/data_def_test.csv
      hash: md5
      md5: acc7737051ce4eac318acb55b94c2103
      size: 23541963
    - path: gen/data_def_train.csv
      hash: md5
      md5: dfc128ae659522e57ef25406179c3323
      size: 55177911
    - path: gen/main_stratify_counts.csv
      hash: md5
      md5: 7a83bf8c820fc071b39db06b5ca8e944
      size: 1310
    - path: gen/main_stratify_counts_after_threshold.csv
      hash: md5
      md5: 91791fc830c527737269e256798a5f0b
      size: 1012
  split_and_tag:
    cmd:
    - python src-modeling/1.0_split_dataset.py
    - python src-modeling/1.1_test_dataset.py
    deps:
    - path: results/data_def.csv
      hash: md5
      md5: afb9d8a1ee4f7e74bb293f0553af227b
      size: 54659768
    - path: src-modeling/1.0_split_dataset.py
      hash: md5
      md5: 73f4b0514fe860a3ffd7a9759dcc0298
      size: 5036
    - path: src-modeling/1.1_test_dataset.py
      hash: md5
      md5: 916512ea0b03e84231692e07de99b445
      size: 691
    outs:
    - path: gen/data_def_test.csv
      hash: md5
      md5: 0837225d6f666c7b6d41e8197bf948ad
      size: 24065401
    - path: gen/data_def_train.csv
      hash: md5
      md5: dfc128ae659522e57ef25406179c3323
      size: 55177911
    - path: gen/main_stratify_counts.csv
      hash: md5
      md5: 7a83bf8c820fc071b39db06b5ca8e944
      size: 1310
    - path: gen/main_stratify_counts_after_threshold.csv
      hash: md5
      md5: 91791fc830c527737269e256798a5f0b
      size: 1012
